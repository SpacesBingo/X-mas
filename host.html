<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Host controle â€“ X-Mas Bingo ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #050b16;
      --bg-panel: #081724;
      --accent: #ff4b4b;
      --accent-soft: rgba(255, 75, 75, 0.3);
      --text-main: #f7f7ff;
      --text-soft: #a9b3c4;
      --success: #00c878;
      --danger: #ff4b4b;
      --card-bg: #050d18;
      --card-border: #1f2a3c;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #142438 0, #050b16 55%, #01030a 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .host-shell {
      width: 100%;
      max-width: 900px;
      border-radius: 24px;
      border: 2px solid var(--accent-soft);
      padding: 24px 20px 22px;
      background: radial-gradient(circle at top left, rgba(255, 75, 75, 0.08), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(0, 255, 180, 0.08), transparent 45%),
                  linear-gradient(135deg, #040814, #071320 60%, #040814 100%);
      box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.02),
        0 40px 80px rgba(0, 0, 0, 0.75);
    }

    @media (min-width: 768px) {
      .host-shell {
        padding: 28px 32px 26px;
      }
    }

    .host-title {
      font-size: clamp(1.2rem, 2.1vw, 1.5rem);
      font-weight: 700;
      text-align: center;
      margin-bottom: 4px;
    }

    .host-title span {
      font-size: 1.25em;
      vertical-align: middle;
    }

    .host-subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-bottom: 20px;
    }

    .host-grid {
      display: grid;
      grid-template-columns: 1.35fr 0.9fr;
      gap: 14px;
    }

    @media (max-width: 720px) {
      .host-grid {
        grid-template-columns: 1fr;
      }
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.09);
      background: rgba(0, 0, 0, 0.36);
      padding: 9px 11px;
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(255, 255, 255, 0.32);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(0, 255, 180, 0.65);
      box-shadow: 0 0 0 1px rgba(0, 255, 180, 0.25);
      background: rgba(0, 0, 0, 0.6);
    }

    .round-select {
      width: 100%;
    }

    .controls-row {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .card-id-row {
      margin-top: 10px;
      margin-bottom: 6px;
      display: flex;
      align-items: baseline;
      gap: 6px;
      font-size: 0.85rem;
    }

    .card-id-label {
      color: var(--text-soft);
    }

    .card-id-value {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: 0.04em;
      font-weight: 600;
      color: #ffffff;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff4b4b, #ff914d);
      color: #fff;
      font-weight: 700;
      font-size: 0.95rem;
      padding: 9px 22px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.7),
        0 0 12px rgba(255, 106, 74, 0.7);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 6px 14px rgba(0, 0, 0, 0.9),
        0 0 6px rgba(255, 106, 74, 0.4);
      filter: brightness(0.97);
    }

    .tip {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .result-message {
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .result-message.ok {
      color: var(--success);
    }

    .result-message.fail {
      color: var(--danger);
    }

    /* Klikbare nummers voor host */
    .host-number-grid-wrapper {
      margin-top: 10px;
    }

    .host-number-grid-title {
      font-size: 0.8rem;
      opacity: 0.9;
      margin-bottom: 6px;
      color: var(--text-soft);
    }

    .host-number-grid {
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 4px;
    }

    .host-number-btn {
      padding: 4px 0;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.04);
      font-size: 0.8rem;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition:
        transform 0.05s ease,
        background 0.1s ease,
        border-color 0.1s ease,
        box-shadow 0.1s ease;
    }

    .host-number-btn:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }

    .host-number-btn.selected {
      background: rgba(0, 200, 120, 0.9);
      border-color: rgba(0, 0, 0, 0.7);
      color: #ffffff;
      font-weight: 700;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.6);
    }

    /* Kaart van speler */
    .player-card-wrapper {
      margin-top: 18px;
      border-radius: 16px;
      border: 1px solid var(--card-border);
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.05), transparent 60%),
                  var(--card-bg);
      padding: 12px 12px 10px;
    }

    .player-card-title {
      font-size: 0.9rem;
      margin-bottom: 10px;
      color: var(--text-soft);
    }

    .player-card-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 4px;
    }

    .player-card-cell {
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(0, 0, 0, 0.35);
      padding: 9px 0;
      font-size: 0.9rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .player-card-cell.marked {
      background: linear-gradient(135deg, rgba(0, 200, 120, 0.8), rgba(0, 255, 180, 0.9));
      border-color: rgba(0, 0, 0, 0.7);
      color: #02140a;
      font-weight: 700;
      box-shadow: 0 0 12px rgba(0, 255, 170, 0.6);
    }

    .footer-line {
      margin-top: 12px;
      font-size: 0.72rem;
      color: rgba(255, 255, 255, 0.5);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }
  </style>
</head>
<body>
  <div class="host-shell">
    <h1 class="host-title">Host controle â€“ X-Mas Bingo <span>ðŸŽ„</span></h1>
    <p class="host-subtitle">
      Vul @handle, ronde en getrokken nummers in om een bingo te controleren.
    </p>

    <div class="host-grid">
      <div class="field-group">
        <label for="hostHandleInput">X @handle van speler</label>
        <input
          id="hostHandleInput"
          type="text"
          placeholder="@spelersnaam"
          autocomplete="off"
        />
      </div>

      <div class="field-group">
        <label for="roundSelect">Ronde</label>
        <select id="roundSelect" class="round-select">
          <option value="1">Ronde 1</option>
          <option value="2">Ronde 2</option>
          <option value="3">Ronde 3</option>
        </select>
      </div>
    </div>

    <!-- Kaart-ID van de speler (Ã©Ã©n ID voor de kaart, alle rondes) -->
    <div class="card-id-row">
      <span class="card-id-label">Kaart-ID:</span>
      <span id="cardIdValue" class="card-id-value">â€“</span>
    </div>

    <div class="field-group" style="margin-top: 14px;">
      <label for="drawnNumbersInput">Getrokken nummers (tot en met het bingonummer)</label>
      <textarea
        id="drawnNumbersInput"
        placeholder="Bijv.: 5 14 22 37 44 60 73"
      ></textarea>

      <!-- Klikbare nummers -->
      <div class="host-number-grid-wrapper">
        <p class="host-number-grid-title">
          Klik op de nummers die getrokken zijn (1â€“75):
        </p>
        <div id="hostNumberGrid" class="host-number-grid"></div>
      </div>
    </div>

    <div class="controls-row">
      <button id="checkBingoButton" class="btn-primary">
        Controleer bingo
      </button>
      <span class="tip">
        Tip: je kunt nummers scheiden met spaties, komma's of nieuwe regels. Dubbele nummers
        worden automatisch genegeerd.
      </span>
    </div>

    <div id="hostResult" class="result-message"></div>

    <div class="player-card-wrapper">
      <div class="player-card-title">
        Kaart van speler (geselecteerde ronde)
      </div>
      <div id="playerCardContainer" class="player-card-grid">
        <!-- kaart komt hier -->
      </div>
    </div>

    <div class="footer-line">
      <span id="generatedAt"></span>
      <span>Â© spacesbingo</span>
    </div>
  </div>

  <script>
    /*********************************************************
     *  RNG & kaartgeneratie â€“ zelfde principe als index
     *********************************************************/
    function cyrb128(str) {
      let h1 = 1779033703, h2 = 3144134277,
          h3 = 1013904242, h4 = 2773480762;
      for (let i = 0, k; i < str.length; i++) {
        k = str.charCodeAt(i);
        h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
        h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
        h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
        h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
      }
      h1 = Math.imul(h3 ^ (h1 >>> 18), 597399067);
      h2 = Math.imul(h4 ^ (h2 >>> 22), 2869860233);
      h3 = Math.imul(h1 ^ (h3 >>> 17), 951274213);
      h4 = Math.imul(h2 ^ (h4 >>> 19), 2716044179);
      return [(h1 ^ h2 ^ h3 ^ h4) >>> 0];
    }

    function mulberry32(a) {
      return function() {
        let t = a += 0x6d2b79f5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    function createRngFromHandleAndRound(handle, round) {
      const base = (handle || "").trim().toLowerCase();
      const key = base + "::" + round;
      const [seed] = cyrb128(key);
      return mulberry32(seed);
    }

    // 3 rondes, elk 15 nummers uit 1â€“75
    function generateCardNumbers(handle, round) {
      const rng = createRngFromHandleAndRound(handle, round);
      const pool = [];
      for (let i = 1; i <= 75; i++) pool.push(i);

      // shuffle met RNG
      for (let i = pool.length - 1; i > 0; i--) {
        const j = Math.floor(rng() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }

      return pool.slice(0, 15).sort((a, b) => a - b);
    }

    // Kaart-ID: 1 ID per kaart (voor alle 3 rondes), zelfde als index.html
    function generateCardId(handle) {
      const base = (handle || "").trim().toLowerCase();
      if (!base) return "â€“";

      const key = base + "::card";   // zelfde key als in index.html
      const [seed] = cyrb128(key);
      const short = (seed % 1000000).toString().padStart(6, "0");
      return "SB-" + short;
    }

    function updateCardIdDisplay() {
      const handleInput = document.getElementById("hostHandleInput");
      const cardIdEl = document.getElementById("cardIdValue");
      if (!handleInput || !cardIdEl) return;

      const handle = (handleInput.value || "").trim();
      if (!handle) {
        cardIdEl.textContent = "â€“";
        return;
      }

      cardIdEl.textContent = generateCardId(handle);
    }

    /*********************************************************
     *  Host-number grid (klikbare nummers)
     *********************************************************/
    const MAX_BINGO_NUMBER = 75;

    function initHostNumberGrid() {
      const grid = document.getElementById('hostNumberGrid');
      const drawnInput = document.getElementById('drawnNumbersInput');
      if (!grid || !drawnInput) return;

      // knoppen 1â€“MAX_BINGO_NUMBER
      for (let i = 1; i <= MAX_BINGO_NUMBER; i++) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = i;
        btn.className = 'host-number-btn';
        btn.dataset.number = String(i);

        btn.addEventListener('click', () => {
          btn.classList.toggle('selected');
          updateDrawnNumbersFromGrid(grid, drawnInput);
        });

        grid.appendChild(btn);
      }

      // als host in het tekstvak typt, sync terug naar grid
      drawnInput.addEventListener('input', () => {
        syncGridFromInput(grid, drawnInput);
      });
    }

    function updateDrawnNumbersFromGrid(grid, drawnInput) {
      const selectedButtons = grid.querySelectorAll('.host-number-btn.selected');
      const numbers = Array.from(selectedButtons)
        .map(btn => parseInt(btn.dataset.number, 10))
        .filter(n => !isNaN(n))
        .sort((a, b) => a - b);

      drawnInput.value = numbers.join(' ');
    }

    function syncGridFromInput(grid, drawnInput) {
      const raw = drawnInput.value;
      const nums = raw
        .split(/[\s,;]+/)
        .map(x => parseInt(x, 10))
        .filter(n => !isNaN(n));

      const set = new Set(nums);
      grid.querySelectorAll('.host-number-btn').forEach(btn => {
        const n = parseInt(btn.dataset.number, 10);
        if (set.has(n)) {
          btn.classList.add('selected');
        } else {
          btn.classList.remove('selected');
        }
      });
    }

    /*********************************************************
     *  Bingo-check & kaart tonen
     *********************************************************/
    function parseDrawnNumbers(raw) {
      return Array.from(
        new Set(
          raw
            .split(/[\s,;]+/)
            .map(x => parseInt(x, 10))
            .filter(n => !isNaN(n))
        )
      );
    }

    function renderPlayerCard(container, numbers, drawnSet) {
      container.innerHTML = '';
      numbers.forEach(num => {
        const cell = document.createElement('div');
        cell.className = 'player-card-cell';
        cell.textContent = num;
        if (drawnSet.has(num)) {
          cell.classList.add('marked');
        }
        container.appendChild(cell);
      });
    }

    function handleCheckBingo() {
      const handleInput = document.getElementById('hostHandleInput');
      const roundSelect = document.getElementById('roundSelect');
      const drawnInput = document.getElementById('drawnNumbersInput');
      const resultEl = document.getElementById('hostResult');
      const cardContainer = document.getElementById('playerCardContainer');

      const handle = (handleInput.value || '').trim();
      const round = parseInt(roundSelect.value, 10);
      const drawnNumbers = parseDrawnNumbers(drawnInput.value || '');

      if (!handle) {
        resultEl.textContent = 'Vul eerst een X @handle van de speler in.';
        resultEl.className = 'result-message fail';
        return;
      }

      if (drawnNumbers.length === 0) {
        resultEl.textContent = 'Vul of klik minimaal Ã©Ã©n getrokken nummer in.';
        resultEl.className = 'result-message fail';
        return;
      }

      const cardNumbers = generateCardNumbers(handle, round);
      const drawnSet = new Set(drawnNumbers);

      renderPlayerCard(cardContainer, cardNumbers, drawnSet);

      const allOnCard = cardNumbers.every(n => drawnSet.has(n));
      if (allOnCard) {
        resultEl.textContent =
          'âœ… Geldige bingo voor ' + handle + ' in ronde ' + round + '!';
        resultEl.className = 'result-message ok';
      } else {
        resultEl.textContent =
          'âŒ Geen volledige bingo voor ' + handle + ' in ronde ' + round + '.';
        resultEl.className = 'result-message fail';
      }
    }

    /*********************************************************
     *  Init
     *********************************************************/
    document.addEventListener('DOMContentLoaded', () => {
      initHostNumberGrid();

      const checkBtn = document.getElementById('checkBingoButton');
      const handleInput = document.getElementById('hostHandleInput');

      if (checkBtn) {
        checkBtn.addEventListener('click', () => {
          handleCheckBingo();
          updateCardIdDisplay(); // ook bij controleren even bijwerken
        });
      }

      if (handleInput) {
        handleInput.addEventListener('input', updateCardIdDisplay);
      }

      // direct bij load alvast proberen een ID te tonen
      updateCardIdDisplay();

      const ts = new Date();
      const stamp =
        'Gegenereerd op: ' +
        ts.getDate().toString().padStart(2, '0') + '-' +
        (ts.getMonth() + 1).toString().padStart(2, '0') + '-' +
        ts.getFullYear() +
        ' ' +
        ts.getHours().toString().padStart(2, '0') + ':' +
        ts.getMinutes().toString().padStart(2, '0');

      document.getElementById('generatedAt').textContent = stamp;
    });
  </script>
</body>
</html>
